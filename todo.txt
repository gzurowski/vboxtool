Todo:

- vbox backup, second approach: incremental backup
  - basic procedure 'vbox backup' 
    - save session 'savestate'
    - create a snapshot, name=vbox-backup
      VBoxManage snapshot "Ubuntu JeOS" take "vbox-backup"
      - only when there is none, 
    - copy all files
      - first time is taking long because the base-vdi is also copied
      - the next time, the bases-vdi will not change, this imoproves speed dramatically
      - rsync, op basis van datum
    - restart session: 'startvm'
  - periodic cleaning = vbox cleanbackup
    - is needed because the savestate-file (.vdi in the snapshot-map) increases
    - procedure:
      - save session sessie 'savestate'
        - merge (discard) snapshot 
          - maar niet de state!
            VBoxManage snapshot "Ubuntu JeOS" discard "vbox-backup"
          - the snaphot (.sav) will be merged with the base-vdi
        - run the basic-backup procedure (see above)
          - in there, a (new) snapshot is made
          - copy files is slow because the base-vdihas been changed
        - autorun cleanbackup based on:
          - absolute filesize of snapshot-vdi (1 GB?)
          - relative filesize of snapshot-vdi compared base-vdi to (10%)              
    - summary:
      - vbox backup
        - incremental backup
        - procedure 'vbox backupclean' is run automatic within the base-backup
          - based on filesize (absolute/relative) of the snapshot-vdi
      - vbox cleanbackup
        - is the same as 'vbox backup' but with a forced merge
     - /etc/vbox/vbox.conf
       - backupdir=...... # Default: <vbox-homedir>/.backup
       - backupthreshold=......  # Default: 1 GB
  - optimalisation: first restart and then copy
    - is possible because the base- and the snapshot-vdi are readonly
    - exclude last snapshot vdi (this is runtime modified)
    - question if this is needed (rsync time is limited due to local copy) 
- vbox backup, third approach: online backup
  - procedure
    - create snapshot in runtime (thus without saving)
      - session is automatically paused by VirtualBox
    - copy all files 
      - base- and the snapshot-vdi are readonly
      - exclude last snapshot vdi (this is runtime modified)
  - problem(s):
    - the length of the vdi-chain increases each time a new snapshot is created
- implement 'metrics' command
  - is a substitute for the derived values of cpu and mem from 'top'
  - then, the script becomes 2.0.x only!
- munin plugin
  - monitor sessions health (cpu/memory) historical and graphically
  - threshold warning (mail) on exceeded cpu/memory
  - summarize resource occupation
  - based on the new metrics command, run periodically by cron
- webserver
  - run portions of the vbox script:
    - monitor (show), start, save, stop, backup
  - based on python

Tasks:
- test:
  - restore backup

- name vboxcontrol on website: http://farfewertoes.com/code/vboxcontrol/
- Alternative for wait command:
    wait_for_closing_machines() {
        RUNNING_MACHINES=`$SU "$VBOXMANAGE list runningvms" | wc -l`
        if [ $RUNNING_MACHINES != 0 ]; then
            sleep 5
            wait_for_closing_machines
        fi
    }
